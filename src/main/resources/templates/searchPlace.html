<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>조사지 검색</title>
</head>
<body>

<div class="search-place" th:fragment="search-Place-frag(treeList)">
    <div class="input-group mb-3">
        <input type="text" class="form-control" id="inputPlaceKeyword"
               placeholder="조사지를 입력하세요">
        <div class="input-group-append">
            <button class="btn btn-primary" type="button" id="search-place-btn">
                검색</button>
            <!--                alert(place); getResult(); return false;-->
        </div>
    </div>

    <div id="resultdiv">
        <div th:if="${searchList != null}">
            <h3 id="h3title"></h3>
            <script th:inline="javascript">
                /*<![CDATA[*/
                var rspPlace = /*[[${place}]]*/ 'default';
                var resultList = /*[[${searchList}]]*/ 'default';
                /*]]>*/
                console.log(rspPlace," ",resultList)

                document.getElementById('h3title').innerHTML = " "+rspPlace + " 검색 결과 ";
                document.getElementById('h3title').innerHTML += resultList.length + " 건"
                        + " 검색되었습니다.";

            </script>
            <table class="table table-sm table-borderless table-hover">
                <tr>
                    <th scope="col">TID</th>
                    <th scope="col">DIST</th>
                    <th scope="col">DBH</th>
                    <th scope="col">HEIGHT</th>
                    <th scope="col">조사지</th>
                </tr>
                <tr th:each="streel : ${searchList}">
                    <td> <a th:href="@{'/webfist/map/'+${streel.tid}}" th:text="${streel.tid}"></a></td>
                    <td th:text="${streel.dist}"></td>
                    <td th:text="${streel.dbh}"></td>
                    <td th:text="${streel.height}"></td>
                    <td th:text="${streel.investigationPlace}"></td>
                </tr>
            </table>
            <div id="map" style="width:800px;height:800px;"></div>
            <script>
                // 지도 관련 자바스크립트
                let container = document.getElementById('map'); //지도를 담을 영역의 DOM 레퍼런스
                let options = { //지도를 생성할 때 필요한 기본 옵션
                    center: new kakao.maps.LatLng(resultList[resultList.length-1].latitude, resultList[resultList.length-1].longitude), //지도의 중심좌표.
                    level: 3 //지도의 레벨(확대, 축소 정도)
                };
                let map = new kakao.maps.Map(container, options); //지도 생성 및 객체 리턴

                // 마커를 생성합니다
                var imageSrc = "/icon/treeicon.png";




                for (var i = 0; i < resultList.length; i ++) {
                    // 마커 이미지의 이미지 크기 입니다

                    var imageSize = new kakao.maps.Size(24, 35);
                    // 마커 이미지를 생성합니다
                    var markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize);
                    // 마커를 생성합니다
                    var marker = new kakao.maps.Marker({
                        map: map, // 마커를 표시할 지도
                        position: new kakao.maps.LatLng(resultList[i].latitude, resultList[i].longitude), // 마커를 표시할 위치
                        title : resultList[i].tid, // 마커의 타이틀, 마커에 마우스를 올리면 타이틀이 표시됩니다
                        image : markerImage // 마커 이미지
                    });
                }

            </script>
        </div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script type="text/javascript">

        var investplace ;

        $(document).ready(function () {
                $('#search-place-btn').click(function (){
                    investplace = document.getElementById('inputPlaceKeyword');
                    var place = investplace.value;
                    console.log('검색 버튼 클릭');
                    console.log(place);
                    location.href = "/webfist/map/other/1/" + place.toString();
                });
            }
        );


    </script>


</div>
</body>

</html>